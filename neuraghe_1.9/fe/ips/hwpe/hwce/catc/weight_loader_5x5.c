#include <stdint.h>

#define NUM_WEIGHT 26 

// 7x7 masks
static uint16_t mask_7x7_0 [26] = {
  0, 0, 1, 1, 1,
  0, 0, 1, 1, 1,
  1, 1, 2, 2, 2,
  1, 1, 2, 2, 2,
  1, 1, 2, 2, 2,
  0
};
static uint16_t mask_7x7_1 [26] = {
  1, 1, 1, 0, 0,
  1, 1, 1, 0, 0,
  2, 2, 2, 1, 1,
  2, 2, 2, 1, 1,
  2, 2, 2, 1, 1,
  0
};
static uint16_t mask_7x7_2 [26] = {
  1, 1, 2, 2, 2,
  1, 1, 2, 2, 2,
  1, 1, 2, 2, 2,
  0, 0, 1, 1, 1,
  0, 0, 1, 1, 1,
  0
};
static uint16_t mask_7x7_3 [26] = {
  2, 2, 2, 1, 1,
  2, 2, 2, 1, 1,
  2, 2, 2, 1, 1,
  1, 1, 1, 0, 0,
  1, 1, 1, 0, 0,
  0
};

// 9x9 masks
static uint16_t mask_9x9_0 [26] = {
  0, 0, 0, 0, 1,
  0, 0, 0, 0, 1,
  0, 0, 0, 0, 1,
  0, 0, 0, 0, 1,
  1, 1, 1, 1, 2,
  0
};
static uint16_t mask_9x9_1 [26] = {
  1, 0, 0, 0, 0,
  1, 0, 0, 0, 0,
  1, 0, 0, 0, 0,
  1, 0, 0, 0, 0,
  2, 1, 1, 1, 1,
  0
};
static uint16_t mask_9x9_2 [26] = {
  1, 1, 1, 1, 2,
  0, 0, 0, 0, 1,
  0, 0, 0, 0, 1,
  0, 0, 0, 0, 1,
  0, 0, 0, 0, 1,
  0
};
static uint16_t mask_9x9_3 [26] = {
  2, 1, 1, 1, 1,
  1, 0, 0, 0, 0,
  1, 0, 0, 0, 0,
  1, 0, 0, 0, 0,
  1, 0, 0, 0, 0,
  0
};

// 11x11 masks
static uint16_t mask_11x11_0 [26] = {
  0, 0, 0, 1, 1,
  0, 0, 0, 1, 1,
  0, 0, 0, 1, 1,
  1, 1, 1, 2, 2,
  1, 1, 1, 2, 2,
  0
};
static uint16_t mask_11x11_1 [26] = {
  1, 1, 0, 1, 1,
  1, 1, 0, 1, 1,
  1, 1, 0, 1, 1,
  2, 2, 1, 2, 2,
  2, 2, 1, 2, 2,
  0
};
static uint16_t mask_11x11_2 [26] = {
  1, 1, 0, 0, 0,
  1, 1, 0, 0, 0,
  1, 1, 0, 0, 0,
  2, 2, 1, 1, 1,
  2, 2, 1, 1, 1,
  0
};
static uint16_t mask_11x11_3 [26] = {
  1, 1, 1, 2, 2,
  1, 1, 1, 2, 2,
  0, 0, 0, 1, 1,
  1, 1, 1, 2, 2,
  1, 1, 1, 2, 2,
  0
};
static uint16_t mask_11x11_4 [26] = {
  2, 2, 1, 2, 2,
  2, 2, 1, 2, 2,
  1, 1, 0, 1, 1,
  2, 2, 1, 2, 2,
  2, 2, 1, 2, 2,
  0
};
static uint16_t mask_11x11_5 [26] = {
  2, 2, 1, 1, 1,
  2, 2, 1, 1, 1,
  1, 1, 0, 0, 0,
  2, 2, 1, 1, 1,
  2, 2, 1, 1, 1,
  0
};
static uint16_t mask_11x11_6 [26] = {
  1, 1, 1, 2, 2,
  1, 1, 1, 2, 2,
  0, 0, 0, 1, 1,
  0, 0, 0, 1, 1,
  0, 0, 0, 1, 1,
  0
};
static uint16_t mask_11x11_7 [26] = {
  2, 2, 1, 2, 2,
  2, 2, 1, 2, 2,
  1, 1, 0, 1, 1,
  1, 1, 0, 1, 1,
  1, 1, 0, 1, 1,
  0
};
static uint16_t mask_11x11_8 [26] = {
  2, 2, 1, 1, 1,
  2, 2, 1, 1, 1,
  1, 1, 0, 0, 0,
  1, 1, 0, 0, 0,
  1, 1, 0, 0, 0,
  0
};

void weight_loader_5x5(uint32_t weight_tcdm[26/2+1], uint16_t weight_priv[26], int size, int mask) {
  for(int i=0; i<26/2; i++) {
    weight_priv[i*2]   = ((uint16_t) ((weight_tcdm[i] & 0xffff0000) >> 16) ) >> ( (size<=5) ? 0 :
      (size==7) ? ( (mask==0) ? mask_7x7_0[i*2]   : (mask==1) ? mask_7x7_1[i*2]   : (mask==2) ? mask_7x7_2[i*2]   : mask_7x7_3[i*2]  ) :
      (size==9) ? ( (mask==0) ? mask_9x9_0[i*2]   : (mask==1) ? mask_9x9_1[i*2]   : (mask==2) ? mask_9x9_2[i*2]   : mask_9x9_3[i*2]  ) :
      ( (mask==0) ? mask_11x11_0[i*2]   : (mask==1) ? mask_11x11_1[i*2]   : (mask==2) ? mask_11x11_2[i*2]   : 
        (mask==3) ? mask_11x11_3[i*2]   : (mask==4) ? mask_11x11_4[i*2]   : (mask==5) ? mask_11x11_5[i*2]   : 
        (mask==6) ? mask_11x11_6[i*2]   : (mask==7) ? mask_11x11_7[i*2]   : mask_11x11_8[i*2] ) );
    weight_priv[i*2+1] = ((uint16_t) (weight_tcdm[i] & 0x0000ffff)         ) >> ( (size<=5) ? 0 :
      (size==7) ? ( (mask==0) ? mask_7x7_0[i*2+1] : (mask==1) ? mask_7x7_1[i*2+1] : (mask==2) ? mask_7x7_2[i*2+1] : mask_7x7_3[i*2+1]) :
      (size==9) ? ( (mask==0) ? mask_9x9_0[i*2+1] : (mask==1) ? mask_9x9_1[i*2+1] : (mask==2) ? mask_9x9_2[i*2+1] : mask_9x9_3[i*2+1]) :
      ( (mask==0) ? mask_11x11_0[i*2+1] : (mask==1) ? mask_11x11_1[i*2+1] : (mask==2) ? mask_11x11_2[i*2+1] : 
        (mask==3) ? mask_11x11_3[i*2+1] : (mask==4) ? mask_11x11_4[i*2+1] : (mask==5) ? mask_11x11_5[i*2+1] : 
        (mask==6) ? mask_11x11_6[i*2+1] : (mask==7) ? mask_11x11_7[i*2+1] : mask_11x11_8[i*2+1] ) );
  }
  weight_tcdm[26/2] = 1;
  return;
}
